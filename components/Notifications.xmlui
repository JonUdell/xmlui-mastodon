<Component name="Notifications">

  <AppState id="toolsState" bucket="toolsState" initialValue="{{ zoom: 20, displayMode: 'minimal' }}" />

  <DataSource
    id="notifications"
    url="{ window.query }"
    body="{ window.permanentNotifications(50) }"
    method="POST"
  />


  <APICall
    id="updateNotifications"
    method="post"
    url="{window.query}"
    body="{ window.customSql(window.updateNotifications) }"
  />

  <Timer
      id="notificationTimer"
      interval="180000"
      initialDelay="5000"
      onTick="updateNotifications.execute()"
    />


  <VStack>
    <HStack>
      <VStack width="90%" maxWidth="90vw" marginRight="$space-4">
        <Items data="{notifications}">
          <VStack>
            <HStack gap="0.5rem" verticalAlignment="center">
              <MastodonAvatar
                url="{$item.avatar_url}"
                size="xs"
                name="{$item.display_name}"
                item="{$item}"
              />
              <Text variant="strong">{$item.display_name}</Text>
              <Text>{window.getNotificationType($item.category)}</Text>
              <SpaceFiller />
              <Text variant="caption" fontSize="smaller" color="$color-text-subtle">{formatHumanElapsedTime($item.created_at)}</Text>
            </HStack>

            <!-- Content if available -->
            <Fragment when="{$item.status_content}">
              <VStack marginLeft="$space-2">
                <Theme marginLeft-Image-markdown="$space-0">
                  <Markdown content="{$item.status_content}" />
                </Theme>
                <Fragment when="{$item.preview_url}">
                  <Image src="{$item.preview_url}" width="{toolsState.value.zoom}%" />
                </Fragment>
              </VStack>
            </Fragment>

            <ContentSeparator />
          </VStack>
        </Items>
      </VStack>
    </HStack>
  </VStack>
</Component>