<Component name="Home">

  <DataSource
    id="tootsHome"
    url="{ window.pipesQuery }"
    headers='{ {Authorization: "Bearer " + window.config.pipesToken, "content-type":"application/json" } }'
    body="{ window.tootsHome(20) }"
    resultSelector="items"
    method="POST"
  />

  <VStack>
    <H1>Home Timeline</H1>

    <Items data="{tootsHome}">

      <VStack>
        <!-- Row 1: User info, date, link -->
        <HStack>
          <Text variant="strong">{$item.display_name || $item.username}</Text>
          <Text variant="caption">@{$item.username}</Text>
          <Text variant="caption">{window.formatDate($item.created_at)}</Text>
        </HStack>

        <!-- Row 2: Toot content -->
        <VStack>
          <Fragment when="{$item.status && $item.status.content}">
            <Markdown content="{$item.status.content}" />
          </Fragment>

          <Fragment when="{$item.reblog && $item.reblog.content}">
            <HStack>
              <Text variant="caption">♻️</Text>
              <Text variant="strong">{$item.reblog.account ?
                $item.reblog.account.display_name : ''}</Text>
              <Text variant="caption">@{$item.reblog.account ?
                $item.reblog.account.username : ''}</Text>
            </HStack>
            <Markdown content="{$item.reblog.content}" />
          </Fragment>

          <Fragment
            when="{$item.status && $item.status.media_attachments && $item.status.media_attachments.length > 0}">
            <Text variant="caption">🖼️ {$item.status.media_attachments.length} media</Text>
          </Fragment>
        </VStack>

        <!-- Row 3: Reactions -->
        <HStack>
          <Text variant="caption">💬 {$item.replies_count || 0}</Text>
          <Text variant="caption">♻️ {$item.reblogs_count || 0}</Text>
          <Text variant="caption">⭐ {$item.favourites_count || 0}</Text>
        </HStack>
      </VStack>
      <ContentSeparator/>
    </Items>
  </VStack>

</Component>